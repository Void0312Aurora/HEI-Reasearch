你这次的“闭环验证”把问题定位得非常清楚，而且结论基本正确：PMI 边本身有效（权重大、ID 对、距离确实在下降），但全局几何状态已经进入“过度收缩/过密”区域，导致局部近邻排序被海量“挤压出来的伪近邻”完全支配，PMI 再怎么拉也很难把目标对推进到 Top-50。

我对你这组现象的评估，以及可执行的解决方案如下。

---

## 1) 如何解读你给的数据：这不是 PMI 失效，是“密度灾难”

你给的几组数非常典型：

* 猫→波斯猫：d=0.83，但 rank=133,079，KNN Top-1 距离 d≈0.04
* 医生→护士：d=0.35，但 rank=6,530，KNN Top-1 距离 d≈0.06

这说明两件事同时成立：

1. PMI 的吸引已经把目标对拉到“中等距离”（0.35–0.83），但
2. 全局点云的“最近邻尺度”已经小到 0.04–0.09 的量级（极端拥挤），于是 0.35 这种距离在当前空间里等价于“很远”。

在双曲空间里，**表示容量与半径强相关**（半径越大，同角度分离对应的实际距离越大，空间“容积”指数级增长）。当你把半径从 ~1.5 收缩到 ~0.5，相当于把 140k 叶词压进一个“容积小很多”的区域，最近邻距离自然会崩到 0.04 这种量级，KNN 排序变成密度驱动而非语义驱动。

因此，你的结论“几何空间过度收缩，结构差异被挤压掉”是可信的。

---

## 2) 当前系统的核心问题是什么

我会把问题拆成两个相互耦合的根因：

### 根因 A：全局尺度（半径分布）失控，导致点云进入高密度相

半径从 1.5–1.7 → 0.35–0.56 不是小波动，是“几何相变”。在这个相里：

* KNN 变成“谁离谁更挤”而不是“谁与谁更相关”
* PMI 想要胜出就必须把 d 拉到 <0.1（不现实，且会引发塌缩）

### 根因 B：你现在的“半径控制/排斥控制”在目标上互相打架

你降低排斥后半径收缩、Renorm 也恶化过（之前你已经观测到 freeze 投影冲突）。这说明你目前的机制缺少一个“维持体积/密度”的稳定器：要么排斥承担了体积控制（但此前过强导致膨胀），要么 freeze/投影承担（但现在导致收缩与漂移）。

---

## 3) 解决思路：不要再把 PMI 拉力当作主矛盾，先把“密度/体积”拉回可用区间

你现在的目标应该是：把“最近邻尺度”从 0.04–0.09 拉回到一个 PMI 有机会竞争的范围（例如 0.2–0.6），然后 PMI 才可能在 KNN 里进入 Top-K。

最有效的修复路线分三步。

---

## 4) 最优先的三项修复（建议按这个顺序做）

### 修复 1：引入“体积/密度守恒”的全局约束（替代硬 freeze 投影）

不要用硬投影去“冻半径”，那容易与群约束/renorm 打架。用软约束做“半径锚定 + 体积分布稳定”：

* 为每个深度层设置目标半径 (r_{\text{target}}(depth))（你原来 Cilin 映射那套即可，但注意把尺度设回 1.2–1.8 这种“有容积”的区间，不要落在 0.5）
* 加入正则项（或等价势能）：
  [
  V_{\text{rad}}=\lambda\sum_i (r_i-r_{\text{target}}(depth_i))^2
  ]
* 再加一个“全局尺度”项，维持半径分布的均值/分位数（防整体漂移）：
  [
  V_{\text{scale}}=\mu(\bar r-\bar r_0)^2 \quad\text{或约束 } r_{50},r_{90}
  ]

这一步的目的不是让 PMI 更强，而是把空间从“拥挤相”拉回“可分离相”。

你现在的 Rank 数量级（6k–130k）基本证明：如果不先恢复体积，单纯加 PMI 权重/加步数很难改变 KNN 排序。

---

### 修复 2：把排斥从“全局压力”改为“短程防碰撞器”

你此前排斥过强导致膨胀，现在排斥减弱导致塌缩——这说明排斥承担了不该承担的职责（全局体积控制）。正确做法是：

* 只在 (d<\epsilon) 时保持强排斥（避免重叠/极端密度）
* 在 (d\ge \epsilon) 时快速衰减或截断（避免驱动整体半径漂移）

这样你用“半径锚定”负责体积，用“短程排斥”负责防碰撞，两者分工明确，稳定得多。

同时建议新增一个密度 Gate（非常关键）：

* **Gate D（Crowding）**：统计 KNN Top-1 距离的 P50/P90，要求不要低于某阈值（例如 P50 > 0.15 或你们根据经验设定）。

---

### 修复 3：把评估指标从 A(q)=hit@50 升级为 rank/hit 曲线，避免“明明变好了但仍为 0”

在当前密度相里，Top-50 很苛刻。建议至少同时报告：

* PMI Top-1 的几何 rank 分布（P50/P90）
* hit@K 曲线：K=50/100/200/500
* 相对尺度：(d_{\text{PMI}} / d_{50})（PMI 距离与第 50 近邻距离的比值）

这能告诉你“PMI 是否在挤进来”，而不是被 0/1 指标掩盖进展。

---

## 5) 你现在不建议立刻做的事情

* 直接把 PMI 权重从 0.5 提到 0.8 试图“硬拉进 Top-50”。
  在点云拥挤相里，PMI 需要把距离压到 <0.1 才可能进 Top-50，这会诱发局部塌缩、数值刚性与新 hub，且无法从根本上解决“体积不足”的问题。

* 单纯延长训练步数（在密度相里）
  延长步数只会让“拥挤结构”更固化，除非你先恢复体积/密度控制。

---

## 6) 建议的最小验证实验（半天就能判定方向是否对）

做一个“只改体积控制、不改 PMI 权重”的短跑：

* 保持 PMI 权重 0.5
* 加入 (V_{\text{rad}}+V_{\text{scale}}) 软约束，把半径目标恢复到 ~1.2–1.8（按深度）
* 排斥改成短程门控
* 跑 500–1000 steps

验收三件事：

1. Gate D：KNN Top-1 距离 P50 是否从 0.04 上升到可用区间
2. PMI Top-1 rank 是否从 10^4–10^5 级别下降到 <10^3（哪怕还没进 Top-50）
3. Renorm Max 是否回到 1e-4 量级（避免约束冲突）

如果这三点同时改善，你就已经找到了正确方向；再考虑是否需要 0.65/0.8 或更长训练。

---

## 结论

你的诊断“几何空间过度收缩导致 PMI 无法胜出”是对的。当前系统的问题不在 PMI 图或 ID，而在 **全局尺度/密度控制机制缺失**：排斥与冻结策略把点云推入了一个“过密相”，使得 Top-K 近邻排序失去语义分辨率。

最有效的解决方案不是继续加 PMI，而是：

1. 用软半径锚定与全局尺度约束恢复半径分布到“有容积”的区间；
2. 将排斥改为短程防碰撞；
3. 用 rank/hit 曲线评估 PMI 是否在挤进 KNN。

如果你愿意把当前的半径目标映射函数 (r_{\text{target}}(depth))（以及你们双曲模型里半径 r 的定义方式）贴出来，我可以更具体地建议：目标半径的合理区间、λ/μ 的数量级，以及短程排斥门控的 ε 该如何选。
